# TR pipeline at UA 

2019-12-11

Present: Tony, Chris, Edwin, David, Eric, Julian (Max, afterwards)

HackMD link: <https://hackmd.io/W9Fj7N5WQzy0AxZxTKQyoA>

Eric: (Nirav says:)

- Tar up files
- Directory structure
- icommands + remove Globus

Tony: Use `irsync` instead of `iput`

David: There is a currently a way to tar up files on NCSA before sending to tape.

Julian: Can we use this as a model for a local solution?

Eric: No Globus

Edwin: The manifest file generated by Globus might be a good place to hook in the IRODS & tar piece.

Eric: Could also do it just before the 'cleanup' step.

Eric: Getting trottled due to many small files, at registration (ireg) as well as download steps.

Chris: What about the metadata for the single files? For discovery, etc. Never mind, that's a workflow issue.

(Discussion of road map)

David: Why such a strong anti-Globus sentiment?

Eric: Replication of infrastructure, maintaining two different, parallel systems.

Julian: (Do not move everything at the same time, reliability, etc. Reliable operation depends on Globus & various scripts.)

Eric: Agreed. (:thumbsup: in front of proposed roadmap.)

![](https://i.imgur.com/Fk4JTyE.jpg)
    

---

Max joins after first meeting finished.

Max:

1. Process A : FTP monitoring (for transfer from gantry)
    - Something that looks for the new files that we need to transfer
    - Runs on cache server
    - Uses the FTP log for that
2. Process B: Did we miss any files? Requeues any transfers
    - If it finds missing files it posts it to the above process (1) which also exposes an API endpoint
3. Process B: Same process also queues it up for deletion

Max wrote 1, and J.D. wrote Process B that does steps 2 and 3

Chris: Day-basis or file-basis?

Max: Both

Max: Need to make sure J.D. is onboard for maintaining Process B

Max: Whole process could be simplified

Chris: Students in ACIC class says it's taking more than 24 hours to process a day's data

Max: Sounds about right

Chris: I figured 12-15 hours

Max: Stitching field mosaic together takes a few hours on its own

David: Maybe we don't need the orthomosaic. Statistically bit more complicated. Could calculate canopy cover per plot.

Max: Worried about what problems and errors we'd introduce

Chris: Think we could address that

(Some talk about keeping track of pixels, averaging, rectangles, etc.)

Max: Sounds fine. But are we algorithm developers or implementors? Should we be responsible, for being on the hook for algorithms which may prove to be incorrect?

David: Talk to scientists

Chris: Laser workflow is relatively simple (talked to some scientist)

Max: Canopy cover is a weird beast

Max: David's suggestion for a weighted option could be interesting

Max: Focus on images from early June where there are plants, but not full canopy cover

Max: And how do we even know we got the right answer? Checking by human is not actually feasible. Eyeballing is what he did.

David: I think conclusion is to stick with what we have, and go back to the algorithm developers

David: New lettuce data is actually private and shouldn't be exposed in the same way the previous data was

Max: Will investigate. Could make each new directory in the raw_data directory private, based on rule set for date combo (enforced in Globus)

David: Will not help next group who wants _their_ data private as well

David: Will go to Duke and next person to ask _how_ private they want their data to be. Might be enough to keep raw_data public, but not let the metadata be public.

Max: Certainly possible. Will talk to somebody about it.

David: Will follow up with PI's

Max: Got a request from (Jeffrey) for processing some full-field FLIR data

David: If its before October this year, then it's not private

Max: OK

David: Once we have a pipeline running reliably on CyVerse we could handle these kinds of requests more easily

Max: New transformer creation process helps to make this easy

Max: What's the state of the Makeflow for end-to-end RGB workflow?

Julian: Class took it over

Chris: Yeah its working

David: They ran into some space issues

David: Want to check with Chris, who mentioned everything is compressed

Max: Yes, there _should_ be compression in the process. Has happened that this compression stage wasn't happening.

Chris: Yes I've seen compression.

Max: Main question answered. Seems close enough to proof-of-concept to be comfortable with switching over to Makeflow. Would be nice to have the confirmation.

Chris: Yes, as soon as we have the CSV result we can compare

Max: After RGB, laser

Max: Action item, start on FLIR transformers

